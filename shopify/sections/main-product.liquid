{{ 'component-card.css' | asset_url | stylesheet_tag }}
{{ 'component-price.css' | asset_url | stylesheet_tag }}
{{ 'component-slider.css' | asset_url | stylesheet_tag }}
{{ 'component-modal-video.css' | asset_url | stylesheet_tag }}

{%- liquid
  assign current_variant = product.selected_or_first_available_variant
  assign hero_bg_image = product.featured_media
  if collection
    assign hero_bg_image = collection.image | default: product.featured_media
  endif

  assign hero_bg_url = "hero_products.jpg" | asset_url
  if hero_bg_image != blank
    assign hero_bg_url = hero_bg_image | image_url: width: 1920, format: 'pjpg'
  endif
-%}

<div class="product-page-container text-[#1a2530]">
  {%- style -%}
    #page-hero-{{ section.id }} {
      background-image: url('{{ hero_bg_url }}');
    }
    #MainContent-body-{{ section.id }} {
      background-image: url('{{ "main_bg_default.jpg" | asset_url }}');
    }
  {%- endstyle -%}

  <section id="page-hero-{{ section.id }}" class="relative bg-cover bg-center -mx-2 md:-mx-[30px] pt-[45px] md:pt-[55px] xl:pt-[65px]">
    <div class="container py-20">
      <div class="text-center text-[#ffe8c9]">
        <p class="font-serif text-4xl lg:text-5xl xl:text-[70px] leading-tight lg:leading-none">{{ product.type | default: "Catalog Details" }}</p>
        <h2 class="outside-double-border flex items-center mx-auto w-48 md:w-36 lg:w-48 xl:w-64 lg:text-lg xl:text-[20px] font-medium leading-tight mt-8">商品詳細</h2>
      </div>
    </div>
  </section>

  <section id="MainContent-body-{{ section.id }}" class="MainContent-body bg-cover bg-top">
    <div class="container block-box">
      <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 lg:gap-12 lg:items-start">

        <div class="product-details lg:col-span-7">
          <product-media-gallery
            class="block product__media-gallery"
            data-desktop-layout="thumbnail"
            data-mobile-layout="slider"
          >
            <div class="relative group cursor-pointer">
              <div id="main-product-image-container-{{ section.id }}" class="relative w-full pt-[81.3802083%] bg-white overflow-hidden">
                <img src="{{ product.featured_media | image_url }}" alt="{{ product.featured_media.alt | escape }}" class="product-main-image is-active absolute inset-0 w-full h-full bg-white object-contain p-4 transition-opacity duration-500 ease-in-out">
              </div>
              <button class="absolute top-4 right-4 w-12 h-12 bg-white/50 rounded-full flex items-center justify-center border border-[#cccccc] group-hover:border-[#1A2530] group-hover:bg-white duration-300">
                <span class="sr-only">拡大表示</span>
                <svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5 group-hover:w-6 group-hover:h-6 duration-300"><path fill-rule="evenodd" d="M13.8,6.6c.3,0,.6.3.6.6v6.6c0,.3-.3.6-.6.6-.3,0-.6-.3-.6-.6v-6.6c0-.3.3-.6.6-.6ZM17.8,10.5c0,.3-.3.6-.6.6h-6.6c-.3,0-.6-.3-.6-.6,0-.3.3-.6.6-.6h6.6c.3,0,.6.3.6.6ZM19.7,16.4c3.3-3.2,3.3-8.5,0-11.8-3.2-3.3-8.5-3.3-11.8,0-3.3,3.2-3.3,8.5,0,11.8,3.2,3.3,8.5,3.3,11.8,0ZM20.6,3.8c3.7,3.7,3.7,9.7,0,13.5-3.7,3.7-9.6,3.7-13.4,0l-5.6,5.5c-.2.2-.6.2-.8,0-.2-.2-.2-.6,0-.8l5.6-5.6c-3-3.7-2.7-9.2.7-12.7C10.9,0,16.9,0,20.6,3.8Z"  clip-rule="evenodd" /></svg>
              </button>
            </div>

            {%- if product.media.size > 1 -%}
              <div class="grid grid-cols-4 gap-1 md:gap-2 mt-3 md:mt-6">
                {%- for media in product.media -%}
                  <a href="{{ media.preview_image | image_url }}" class="product-thumbnail block border-2 {% if forloop.first %}border-sky-500{% else %}border-transparent{% endif %} hover:border-sky-500 transition" data-media-id="{{ media.id }}">
                    <span class="relative block aspect-square overflow-hidden bg-white">
                      <img src="{{ media.preview_image | image_url: width: 200, height: 200, crop: false }}" alt="{{ media.alt | escape }}" class="absolute inset-0 w-full h-full object-contain">
                    </span>
                  </a>
                {%- endfor -%}
              </div>
            {%- endif -%}
          </product-media-gallery>

          {%- comment -%}
            商品説明や特徴などのタブコンテンツはここにレンダリングされます。
            実際のタブ切り替えロジックは別途JavaScriptで実装が必要です。
          {%- endcomment -%}
          {%- for block in section.blocks -%}
            {%- case block.type -%}
              {%- when 'description_tab' -%}
                 {%- if product.description != blank -%}
                    <div class="mt-8 border-t border-white/20 pt-8 text-[#ffe8c9]">
                        <h3 class="text-xl mb-6 bg-[#1a2530] text-white px-4 py-2">製品説明</h3>
                        <div class="rte text-sm leading-relaxed">{{ product.description }}</div>
                    </div>
                 {%- endif -%}
            {%- endcase -%}
          {%- endfor -%}
        </div>

        <div class="product-info lg:col-span-5 lg:sticky lg:top-24">
          <div class="bg-white p-6 md:p-8 lg:p-12">
            <product-form class="product-form">
              <form method="post" action="/cart/add" id="product-form-{{ section.id }}" accept-charset="UTF-8" class="form" enctype="multipart/form-data" novalidate="novalidate" data-type="add-to-cart-form">
                <input type="hidden" name="form_type" value="product">
                <input type="hidden" name="utf8" value="✓">
                <input type="hidden" name="id" value="{{ current_variant.id }}">

                {%- for block in section.blocks -%}
                  <div {{ block.shopify_attributes }}>
                  {%- case block.type -%}
                    {%- when 'title' -%}
                      <h2 class="text-xl md:text-2xl lg:text-3xl leading-tight">{{ product.title | escape }}</h2>
                      <p class="mt-2 text-sm text-gray-500">モデルNo: {{ current_variant.sku | default: 'N/A' }}</p>
                    {%- when 'price' -%}
                       <div class="mt-6">
                         {%- render 'price', product: product, use_variant: true -%}
                       </div>
                    {%- when 'variant_picker' -%}
                      {%- unless product.has_only_default_variant -%}
                        <variant-radios class="mt-6" data-section="{{ section.id }}" data-url="{{ product.url }}">
                          {%- for option in product.options_with_values -%}
                            <fieldset class="js-variant-input-wrapper">
                              <h3 class="text-sm font-semibold mb-2">{{ option.name }}</h3>
                              <div class="flex items-center gap-x-2">
                                {%- for value in option.values -%}
                                  <input type="radio" id="{{ section.id }}-{{ option.position }}-{{ forloop.index0 }}" name="{{ option.name }}" value="{{ value | escape }}" {% if option.selected_value == value %} checked {% endif %}>
                                  <label for="{{ section.id }}-{{ option.position }}-{{ forloop.index0 }}" class="w-8 h-8 rounded-full bg-blue-500 border-2 border-transparent hover:ring-2 hover:ring-offset-2 hover:ring-offset-white hover:ring-sky-500 has-[:checked]:ring-2 has-[:checked]:ring-offset-2 has-[:checked]:ring-sky-500 cursor-pointer">
                                    <span class="sr-only">{{ value }}</span>
                                  </label>
                                {%- endfor -%}
                              </div>
                            </fieldset>
                          {%- endfor -%}
                           <script type="application/json">{{ product.variants | json }}</script>
                        </variant-radios>
                      {%- endunless -%}
                    {%- when 'buy_buttons' -%}
                      <div class="mt-8">
                        <button type="submit" name="add" class="btn block w-full text-center align-middle !text-white {% if current_variant.available == false %} disabled {% endif %}">
                          <span class="py-2 !bg-[#0071BE] before:!bg-white before:opacity-50">
                            <span class="before:!border-white after:!border-white">
                              {%- if current_variant.available -%}
                                {{ 'products.product.add_to_cart' | t }}
                              {%- else -%}
                                {{ 'products.product.sold_out' | t }}
                              {%- endif -%}
                            </span>
                          </span>
                        </button>
                      </div>
                  {%- endcase -%}
                  </div>
                {%- endfor -%}
              </form>
            </product-form>
          </div>
        </div>

      </div>
    </div>
  </section>
</div>

<script src="{{ 'product-form.js' | asset_url }}" defer="defer"></script>
<script src="{{ 'product-media-gallery.js' | asset_url }}" defer="defer"></script>

{% schema %}
{
  "name": "商品ページ",
  "blocks": [
    { "type": "title", "name": "商品名", "limit": 1 },
    { "type": "price", "name": "価格", "limit": 1 },
    { "type": "variant_picker", "name": "バリエーション選択", "limit": 1 },
    { "type": "quantity_selector", "name": "数量セレクター", "limit": 1 },
    { "type": "buy_buttons", "name": "購入ボタン", "limit": 1,
      "settings": [
        {
          "type": "checkbox",
          "id": "show_dynamic_checkout",
          "default": false,
          "label": "動的チェックアウトボタンを表示"
        }
      ]
    },
    { "type": "description", "name": "商品説明(右カラム)", "limit": 1 },
    { "type": "vendor", "name": "販売元", "limit": 1 },
    { "type": "share", "name": "共有ボタン", "limit": 1 },
    { "type": "description_tab", "name": "製品説明(タブ)", "limit": 1 }
  ],
  "settings": [
    {
      "type": "select",
      "id": "gallery_layout",
      "label": "ギャラリーレイアウト(PC)",
      "options": [
        { "value": "stacked", "label": "積み重ね" },
        { "value": "thumbnail", "label": "サムネイル" }
      ],
      "default": "thumbnail"
    },
    {
      "type": "checkbox",
      "id": "enable_video_looping",
      "default": true,
      "label": "ビデオをループ再生する"
    }
  ]
}
{% endschema %}
